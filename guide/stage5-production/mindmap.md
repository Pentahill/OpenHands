# é˜¶æ®µäº”å­¦ä¹ è„‘å›¾ï¼šç”Ÿäº§éƒ¨ç½²

```mermaid
mindmap
  root((é˜¶æ®µäº”<br/>ç”Ÿäº§éƒ¨ç½²<br/>1-2å‘¨))
    éƒ¨ç½²é…ç½®
      æ¶æ„è®¾è®¡
        è´Ÿè½½å‡è¡¡å™¨
        åº”ç”¨æœåŠ¡å™¨
        æ•°æ®åº“é›†ç¾¤
        ç¼“å­˜å±‚
        CDNé…ç½®
      å®¹å™¨åŒ–éƒ¨ç½²
        Dockeré•œåƒ
        Docker Compose
        Kubernetes
        Helm Charts
        é•œåƒä»“åº“
      ç¯å¢ƒç®¡ç†
        å¼€å‘ç¯å¢ƒ
        æµ‹è¯•ç¯å¢ƒ
        é¢„ç”Ÿäº§ç¯å¢ƒ
        ç”Ÿäº§ç¯å¢ƒ
        é…ç½®ç®¡ç†
      åŸºç¡€è®¾æ–½
        äº‘æœåŠ¡é…ç½®
        ç½‘ç»œé…ç½®
        å­˜å‚¨é…ç½®
        å¤‡ä»½ç­–ç•¥
        ç¾éš¾æ¢å¤

    ç›‘æ§å’Œæ—¥å¿—
      ç³»ç»Ÿç›‘æ§
        CPUä½¿ç”¨ç‡
        å†…å­˜ä½¿ç”¨ç‡
        ç£ç›˜ä½¿ç”¨ç‡
        ç½‘ç»œæµé‡
        ç³»ç»Ÿè´Ÿè½½
      åº”ç”¨ç›‘æ§
        å“åº”æ—¶é—´
        ååé‡
        é”™è¯¯ç‡
        å¯ç”¨æ€§
        ç”¨æˆ·ä½“éªŒ
      æ—¥å¿—ç®¡ç†
        æ—¥å¿—æ”¶é›†
        æ—¥å¿—èšåˆ
        æ—¥å¿—åˆ†æ
        æ—¥å¿—å­˜å‚¨
        æ—¥å¿—æ£€ç´¢
      å‘Šè­¦ç³»ç»Ÿ
        å‘Šè­¦è§„åˆ™
        é€šçŸ¥æ¸ é“
        å‡çº§ç­–ç•¥
        å‘Šè­¦æŠ‘åˆ¶
        æ•…éšœè‡ªæ„ˆ
      å¯è§†åŒ–
        ç›‘æ§ä»ªè¡¨æ¿
        æ€§èƒ½å›¾è¡¨
        è¶‹åŠ¿åˆ†æ
        å®æ—¶ç›‘æ§
        å†å²æ•°æ®

    å®‰å…¨é…ç½®
      ç½‘ç»œå®‰å…¨
        é˜²ç«å¢™é…ç½®
        VPNè®¾ç½®
        ç½‘ç»œéš”ç¦»
        DDoSé˜²æŠ¤
        å…¥ä¾µæ£€æµ‹
      åº”ç”¨å®‰å…¨
        HTTPSé…ç½®
        èº«ä»½è®¤è¯
        æˆæƒæ§åˆ¶
        ä¼šè¯ç®¡ç†
        è¾“å…¥éªŒè¯
      æ•°æ®å®‰å…¨
        æ•°æ®åŠ å¯†
        å¯†é’¥ç®¡ç†
        å¤‡ä»½åŠ å¯†
        è®¿é—®æ§åˆ¶
        æ•°æ®è„±æ•
      åˆè§„æ€§
        å®‰å…¨å®¡è®¡
        åˆè§„æ£€æŸ¥
        æ¼æ´æ‰«æ
        å®‰å…¨ç­–ç•¥
        é£é™©è¯„ä¼°
      å®‰å…¨ç›‘æ§
        å®‰å…¨äº‹ä»¶
        å¼‚å¸¸æ£€æµ‹
        å¨èƒæƒ…æŠ¥
        äº‹ä»¶å“åº”
        å–è¯åˆ†æ

    æ€§èƒ½ä¼˜åŒ–
      åº”ç”¨ä¼˜åŒ–
        ä»£ç ä¼˜åŒ–
        ç®—æ³•ä¼˜åŒ–
        å†…å­˜ç®¡ç†
        å¹¶å‘å¤„ç†
        ç¼“å­˜ç­–ç•¥
      æ•°æ®åº“ä¼˜åŒ–
        æŸ¥è¯¢ä¼˜åŒ–
        ç´¢å¼•ä¼˜åŒ–
        è¿æ¥æ± 
        è¯»å†™åˆ†ç¦»
        åˆ†åº“åˆ†è¡¨
      åŸºç¡€è®¾æ–½ä¼˜åŒ–
        è´Ÿè½½å‡è¡¡
        CDNé…ç½®
        ç¼“å­˜å±‚
        ç½‘ç»œä¼˜åŒ–
        å­˜å‚¨ä¼˜åŒ–
      æ€§èƒ½æµ‹è¯•
        å‹åŠ›æµ‹è¯•
        è´Ÿè½½æµ‹è¯•
        å®¹é‡æµ‹è¯•
        ç¨³å®šæ€§æµ‹è¯•
        æ€§èƒ½åŸºå‡†
      è°ƒä¼˜ç­–ç•¥
        ç“¶é¢ˆåˆ†æ
        èµ„æºè°ƒä¼˜
        é…ç½®ä¼˜åŒ–
        æ¶æ„è°ƒæ•´
        æŒç»­ä¼˜åŒ–

    è¿ç»´æµç¨‹
      CI/CDæµæ°´çº¿
        ä»£ç æ„å»º
        è‡ªåŠ¨åŒ–æµ‹è¯•
        éƒ¨ç½²è‡ªåŠ¨åŒ–
        å›æ»šæœºåˆ¶
        å‘å¸ƒç­–ç•¥
      å˜æ›´ç®¡ç†
        å˜æ›´å®¡æ‰¹
        å˜æ›´è®¡åˆ’
        å˜æ›´æ‰§è¡Œ
        å˜æ›´éªŒè¯
        å˜æ›´å›æ»š
      æ•…éšœå¤„ç†
        æ•…éšœæ£€æµ‹
        æ•…éšœå®šä½
        æ•…éšœä¿®å¤
        æ•…éšœå¤ç›˜
        é¢„é˜²æªæ–½
      å®¹é‡ç®¡ç†
        èµ„æºç›‘æ§
        å®¹é‡è§„åˆ’
        å¼¹æ€§ä¼¸ç¼©
        æˆæœ¬ä¼˜åŒ–
        èµ„æºé¢„æµ‹
      æ–‡æ¡£ç®¡ç†
        è¿ç»´æ‰‹å†Œ
        æ•…éšœæ‰‹å†Œ
        éƒ¨ç½²æ–‡æ¡£
        é…ç½®æ–‡æ¡£
        çŸ¥è¯†åº“
```

## ğŸ¯ ç”Ÿäº§éƒ¨ç½²æŠ€æœ¯è·¯å¾„

### 1. éƒ¨ç½²é…ç½®æŠ€æœ¯è·¯å¾„
```mermaid
graph TD
    A[éœ€æ±‚åˆ†æ] --> B[æ¶æ„è®¾è®¡]
    B --> C[ç¯å¢ƒå‡†å¤‡]
    C --> D[å®¹å™¨åŒ–é…ç½®]
    D --> E[åŸºç¡€è®¾æ–½éƒ¨ç½²]
    E --> F[åº”ç”¨éƒ¨ç½²]
    F --> G[é…ç½®éªŒè¯]
    G --> H[æ€§èƒ½æµ‹è¯•]
```

### 2. ç›‘æ§ç³»ç»ŸæŠ€æœ¯è·¯å¾„
```mermaid
graph TD
    A[ç›‘æ§éœ€æ±‚] --> B[æŒ‡æ ‡å®šä¹‰]
    B --> C[ç›‘æ§å·¥å…·é€‰æ‹©]
    C --> D[æ•°æ®æ”¶é›†]
    D --> E[æ•°æ®å­˜å‚¨]
    E --> F[å¯è§†åŒ–å±•ç¤º]
    F --> G[å‘Šè­¦é…ç½®]
    G --> H[è¿ç»´é›†æˆ]
```

### 3. å®‰å…¨é…ç½®æŠ€æœ¯è·¯å¾„
```mermaid
graph TD
    A[å®‰å…¨è¯„ä¼°] --> B[å¨èƒå»ºæ¨¡]
    B --> C[å®‰å…¨ç­–ç•¥]
    C --> D[å®‰å…¨æ§åˆ¶]
    D --> E[å®‰å…¨ç›‘æ§]
    E --> F[åˆè§„æ£€æŸ¥]
    F --> G[å®‰å…¨å®¡è®¡]
    G --> H[æŒç»­æ”¹è¿›]
```

## ğŸ“Š ç”Ÿäº§ç¯å¢ƒèƒ½åŠ›çŸ©é˜µ

| èƒ½åŠ›é¢†åŸŸ | åŸºç¡€çº§åˆ« | ä¸­çº§çº§åˆ« | é«˜çº§çº§åˆ« | ä¸“å®¶çº§åˆ« |
|---------|----------|----------|----------|----------|
| éƒ¨ç½²é…ç½® | å•æœºéƒ¨ç½² | é›†ç¾¤éƒ¨ç½² | äº‘åŸç”Ÿéƒ¨ç½² | å¤šäº‘éƒ¨ç½² |
| ç›‘æ§è¿ç»´ | åŸºç¡€ç›‘æ§ | å…¨é¢ç›‘æ§ | æ™ºèƒ½è¿ç»´ | è‡ªåŠ¨åŒ–è¿ç»´ |
| å®‰å…¨é˜²æŠ¤ | åŸºç¡€å®‰å…¨ | æ·±åº¦é˜²å¾¡ | é›¶ä¿¡ä»»æ¶æ„ | å®‰å…¨è¿è¥ |
| æ€§èƒ½ä¼˜åŒ– | åŸºç¡€è°ƒä¼˜ | ç³»ç»Ÿè°ƒä¼˜ | æ¶æ„ä¼˜åŒ– | å…¨æ ˆä¼˜åŒ– |

## ğŸ› ï¸ æ ¸å¿ƒéƒ¨ç½²æ¨¡å¼

### 1. è“ç»¿éƒ¨ç½²æ¨¡å¼
```yaml
# è“ç»¿éƒ¨ç½²é…ç½®
apiVersion: argoproj.io/v1alpha1
kind: Rollout
metadata:
  name: openhands-rollout
spec:
  replicas: 5
  strategy:
    blueGreen:
      activeService: openhands-active
      previewService: openhands-preview
      autoPromotionEnabled: false
      scaleDownDelaySeconds: 30
      prePromotionAnalysis:
        templates:
        - templateName: success-rate
        args:
        - name: service-name
          value: openhands-preview
      postPromotionAnalysis:
        templates:
        - templateName: success-rate
        args:
        - name: service-name
          value: openhands-active
  selector:
    matchLabels:
      app: openhands
  template:
    metadata:
      labels:
        app: openhands
    spec:
      containers:
      - name: openhands
        image: openhands:latest
        ports:
        - containerPort: 8000
```

### 2. é‡‘ä¸é›€éƒ¨ç½²æ¨¡å¼
```yaml
# é‡‘ä¸é›€éƒ¨ç½²é…ç½®
apiVersion: argoproj.io/v1alpha1
kind: Rollout
metadata:
  name: openhands-canary
spec:
  replicas: 10
  strategy:
    canary:
      steps:
      - setWeight: 10
      - pause: {duration: 1m}
      - setWeight: 20
      - pause: {duration: 1m}
      - setWeight: 50
      - pause: {duration: 1m}
      - setWeight: 100
      canaryService: openhands-canary
      stableService: openhands-stable
      trafficRouting:
        nginx:
          stableIngress: openhands-stable
          annotationPrefix: nginx.ingress.kubernetes.io
          additionalIngressAnnotations:
            canary-by-header: X-Canary
```

### 3. æ»šåŠ¨æ›´æ–°æ¨¡å¼
```yaml
# æ»šåŠ¨æ›´æ–°é…ç½®
apiVersion: apps/v1
kind: Deployment
metadata:
  name: openhands-deployment
spec:
  replicas: 6
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1
      maxSurge: 1
  selector:
    matchLabels:
      app: openhands
  template:
    metadata:
      labels:
        app: openhands
    spec:
      containers:
      - name: openhands
        image: openhands:latest
        readinessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 10
          periodSeconds: 5
        livenessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 30
          periodSeconds: 10
```

## ğŸ” é«˜çº§è¿ç»´æŠ€æœ¯

### 1. è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬
```bash
#!/bin/bash
# è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬

set -e

# é…ç½®å˜é‡
APP_NAME="openhands"
ENVIRONMENT=${1:-production}
VERSION=${2:-latest}
NAMESPACE="openhands-${ENVIRONMENT}"

# é¢œè‰²è¾“å‡º
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

log_info() {
    echo -e "${GREEN}[INFO]${NC} $1"
}

log_warn() {
    echo -e "${YELLOW}[WARN]${NC} $1"
}

log_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# é¢„æ£€æŸ¥
pre_check() {
    log_info "Starting pre-deployment checks..."

    # æ£€æŸ¥kubectlè¿æ¥
    if ! kubectl cluster-info &> /dev/null; then
        log_error "Cannot connect to Kubernetes cluster"
        exit 1
    fi

    # æ£€æŸ¥å‘½åç©ºé—´
    if ! kubectl get namespace $NAMESPACE &> /dev/null; then
        log_info "Creating namespace $NAMESPACE"
        kubectl create namespace $NAMESPACE
    fi

    # æ£€æŸ¥é•œåƒæ˜¯å¦å­˜åœ¨
    if ! docker manifest inspect $APP_NAME:$VERSION &> /dev/null; then
        log_error "Docker image $APP_NAME:$VERSION not found"
        exit 1
    fi

    log_info "Pre-deployment checks passed"
}

# å¤‡ä»½å½“å‰ç‰ˆæœ¬
backup_current_version() {
    log_info "Backing up current version..."

    # è·å–å½“å‰ç‰ˆæœ¬
    CURRENT_VERSION=$(kubectl get deployment $APP_NAME -n $NAMESPACE -o jsonpath='{.spec.template.spec.containers[0].image}' 2>/dev/null || echo "none")

    if [ "$CURRENT_VERSION" != "none" ]; then
        # åˆ›å»ºå¤‡ä»½æ ‡ç­¾
        kubectl label deployment $APP_NAME -n $NAMESPACE backup-version="$CURRENT_VERSION" --overwrite
        log_info "Current version $CURRENT_VERSION backed up"
    fi
}

# éƒ¨ç½²æ–°ç‰ˆæœ¬
deploy_new_version() {
    log_info "Deploying version $VERSION..."

    # æ›´æ–°éƒ¨ç½²é…ç½®
    kubectl set image deployment/$APP_NAME $APP_NAME=$APP_NAME:$VERSION -n $NAMESPACE

    # ç­‰å¾…éƒ¨ç½²å®Œæˆ
    kubectl rollout status deployment/$APP_NAME -n $NAMESPACE --timeout=600s

    log_info "Deployment completed successfully"
}

# å¥åº·æ£€æŸ¥
health_check() {
    log_info "Performing health checks..."

    # ç­‰å¾…Podå°±ç»ª
    kubectl wait --for=condition=ready pod -l app=$APP_NAME -n $NAMESPACE --timeout=300s

    # è·å–æœåŠ¡ç«¯ç‚¹
    SERVICE_IP=$(kubectl get service $APP_NAME -n $NAMESPACE -o jsonpath='{.status.loadBalancer.ingress[0].ip}' 2>/dev/null || echo "localhost")
    SERVICE_PORT=$(kubectl get service $APP_NAME -n $NAMESPACE -o jsonpath='{.spec.ports[0].port}')

    # å¥åº·æ£€æŸ¥
    for i in {1..10}; do
        if curl -f http://$SERVICE_IP:$SERVICE_PORT/health &> /dev/null; then
            log_info "Health check passed"
            return 0
        fi
        log_warn "Health check attempt $i failed, retrying..."
        sleep 10
    done

    log_error "Health check failed after 10 attempts"
    return 1
}

# å›æ»šå‡½æ•°
rollback() {
    log_warn "Rolling back to previous version..."

    # è·å–å¤‡ä»½ç‰ˆæœ¬
    BACKUP_VERSION=$(kubectl get deployment $APP_NAME -n $NAMESPACE -o jsonpath='{.metadata.labels.backup-version}' 2>/dev/null || echo "")

    if [ -n "$BACKUP_VERSION" ]; then
        kubectl set image deployment/$APP_NAME $APP_NAME=$BACKUP_VERSION -n $NAMESPACE
        kubectl rollout status deployment/$APP_NAME -n $NAMESPACE --timeout=300s
        log_info "Rollback completed to version $BACKUP_VERSION"
    else
        kubectl rollout undo deployment/$APP_NAME -n $NAMESPACE
        log_info "Rollback completed to previous version"
    fi
}

# æ¸…ç†å‡½æ•°
cleanup() {
    log_info "Performing cleanup..."

    # æ¸…ç†æ—§çš„ReplicaSets
    kubectl delete replicaset -l app=$APP_NAME -n $NAMESPACE --field-selector='status.replicas==0'

    # æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
    docker system prune -f

    log_info "Cleanup completed"
}

# ä¸»éƒ¨ç½²æµç¨‹
main() {
    log_info "Starting deployment of $APP_NAME:$VERSION to $ENVIRONMENT"

    # æ‰§è¡Œé¢„æ£€æŸ¥
    pre_check

    # å¤‡ä»½å½“å‰ç‰ˆæœ¬
    backup_current_version

    # éƒ¨ç½²æ–°ç‰ˆæœ¬
    if deploy_new_version; then
        # å¥åº·æ£€æŸ¥
        if health_check; then
            log_info "Deployment successful!"
            cleanup
        else
            log_error "Health check failed, rolling back..."
            rollback
            exit 1
        fi
    else
        log_error "Deployment failed, rolling back..."
        rollback
        exit 1
    fi
}

# é”™è¯¯å¤„ç†
trap 'log_error "Deployment failed with error"; rollback; exit 1' ERR

# æ‰§è¡Œä¸»æµç¨‹
main "$@"
```

### 2. ç›‘æ§å‘Šè­¦é…ç½®
```yaml
# Prometheuså‘Šè­¦è§„åˆ™
groups:
- name: openhands.rules
  rules:
  # é«˜CPUä½¿ç”¨ç‡å‘Šè­¦
  - alert: HighCPUUsage
    expr: 100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "High CPU usage detected"
      description: "CPU usage is above 80% for more than 5 minutes on {{ $labels.instance }}"

  # é«˜å†…å­˜ä½¿ç”¨ç‡å‘Šè­¦
  - alert: HighMemoryUsage
    expr: (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100 > 90
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: "High memory usage detected"
      description: "Memory usage is above 90% on {{ $labels.instance }}"

  # åº”ç”¨å“åº”æ—¶é—´å‘Šè­¦
  - alert: HighResponseTime
    expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 2
    for: 3m
    labels:
      severity: warning
    annotations:
      summary: "High response time detected"
      description: "95th percentile response time is above 2 seconds"

  # åº”ç”¨é”™è¯¯ç‡å‘Šè­¦
  - alert: HighErrorRate
    expr: rate(http_requests_total{status=~"5.."}[5m]) / rate(http_requests_total[5m]) * 100 > 5
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: "High error rate detected"
      description: "Error rate is above 5% for the last 5 minutes"

  # Podé‡å¯å‘Šè­¦
  - alert: PodRestartingTooOften
    expr: increase(kube_pod_container_status_restarts_total[1h]) > 3
    for: 0m
    labels:
      severity: warning
    annotations:
      summary: "Pod restarting too often"
      description: "Pod {{ $labels.pod }} in namespace {{ $labels.namespace }} has restarted more than 3 times in the last hour"

  # ç£ç›˜ç©ºé—´å‘Šè­¦
  - alert: DiskSpaceRunningLow
    expr: (node_filesystem_avail_bytes / node_filesystem_size_bytes) * 100 < 15
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Disk space running low"
      description: "Disk space is below 15% on {{ $labels.instance }} mount {{ $labels.mountpoint }}"

---
# AlertManageré…ç½®
global:
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: 'alerts@company.com'
  smtp_auth_username: 'alerts@company.com'
  smtp_auth_password: 'password'

route:
  group_by: ['alertname']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'web.hook'
  routes:
  - match:
      severity: critical
    receiver: 'critical-alerts'
  - match:
      severity: warning
    receiver: 'warning-alerts'

receivers:
- name: 'web.hook'
  webhook_configs:
  - url: 'http://webhook-service:5000/alerts'

- name: 'critical-alerts'
  email_configs:
  - to: 'oncall@company.com'
    subject: '[CRITICAL] {{ .GroupLabels.alertname }}'
    body: |
      {{ range .Alerts }}
      Alert: {{ .Annotations.summary }}
      Description: {{ .Annotations.description }}
      {{ end }}
  slack_configs:
  - api_url: 'https://hooks.slack.com/services/...'
    channel: '#critical-alerts'
    title: '[CRITICAL] {{ .GroupLabels.alertname }}'
    text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'

- name: 'warning-alerts'
  email_configs:
  - to: 'team@company.com'
    subject: '[WARNING] {{ .GroupLabels.alertname }}'
    body: |
      {{ range .Alerts }}
      Alert: {{ .Annotations.summary }}
      Description: {{ .Annotations.description }}
      {{ end }}
```

### 3. æ€§èƒ½ä¼˜åŒ–é…ç½®
```yaml
# æ€§èƒ½ä¼˜åŒ–çš„Kubernetesé…ç½®
apiVersion: apps/v1
kind: Deployment
metadata:
  name: openhands-optimized
spec:
  replicas: 6
  selector:
    matchLabels:
      app: openhands
  template:
    metadata:
      labels:
        app: openhands
    spec:
      # èŠ‚ç‚¹äº²å’Œæ€§
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: node-type
                operator: In
                values: ["compute-optimized"]
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 100
            podAffinityTerm:
              labelSelector:
                matchExpressions:
                - key: app
                  operator: In
                  values: ["openhands"]
              topologyKey: kubernetes.io/hostname

      # å®¹å™¨é…ç½®
      containers:
      - name: openhands
        image: openhands:latest

        # èµ„æºé™åˆ¶å’Œè¯·æ±‚
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "2Gi"
            cpu: "1000m"

        # ç¯å¢ƒå˜é‡ä¼˜åŒ–
        env:
        - name: WORKERS
          value: "4"
        - name: MAX_CONNECTIONS
          value: "1000"
        - name: KEEP_ALIVE_TIMEOUT
          value: "65"
        - name: GRACEFUL_TIMEOUT
          value: "30"

        # å¥åº·æ£€æŸ¥ä¼˜åŒ–
        readinessProbe:
          httpGet:
            path: /health/ready
            port: 8000
          initialDelaySeconds: 5
          periodSeconds: 3
          timeoutSeconds: 2
          failureThreshold: 3

        livenessProbe:
          httpGet:
            path: /health/live
            port: 8000
          initialDelaySeconds: 30
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 3

        # å¯åŠ¨æ¢é’ˆ
        startupProbe:
          httpGet:
            path: /health/startup
            port: 8000
          initialDelaySeconds: 10
          periodSeconds: 5
          timeoutSeconds: 3
          failureThreshold: 10

        # å·æŒ‚è½½
        volumeMounts:
        - name: tmp-volume
          mountPath: /tmp
        - name: cache-volume
          mountPath: /app/cache

      # å·é…ç½®
      volumes:
      - name: tmp-volume
        emptyDir:
          sizeLimit: 1Gi
      - name: cache-volume
        emptyDir:
          sizeLimit: 2Gi

      # ä¼˜åŒ–é…ç½®
      terminationGracePeriodSeconds: 30
      dnsPolicy: ClusterFirst
      restartPolicy: Always

---
# HPAé…ç½®
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: openhands-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: openhands-optimized
  minReplicas: 3
  maxReplicas: 20
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
      - type: Percent
        value: 10
        periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 60
      policies:
      - type: Percent
        value: 50
        periodSeconds: 60
```

## ğŸ“ˆ ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ

### 1. éƒ¨ç½²ç­–ç•¥
- **è“ç»¿éƒ¨ç½²**ï¼šé›¶åœæœºéƒ¨ç½²ï¼Œå¿«é€Ÿå›æ»š
- **é‡‘ä¸é›€éƒ¨ç½²**ï¼šæ¸è¿›å¼å‘å¸ƒï¼Œé£é™©æ§åˆ¶
- **æ»šåŠ¨æ›´æ–°**ï¼šå¹³æ»‘å‡çº§ï¼Œèµ„æºé«˜æ•ˆ
- **A/Bæµ‹è¯•**ï¼šåŠŸèƒ½éªŒè¯ï¼Œç”¨æˆ·ä½“éªŒä¼˜åŒ–

### 2. ç›‘æ§ç­–ç•¥
- **å…¨æ ˆç›‘æ§**ï¼šä»åŸºç¡€è®¾æ–½åˆ°åº”ç”¨å±‚
- **å®æ—¶å‘Šè­¦**ï¼šåŠæ—¶å‘ç°å’Œå“åº”é—®é¢˜
- **æ€§èƒ½åŸºçº¿**ï¼šå»ºç«‹æ€§èƒ½æ ‡å‡†å’Œè¶‹åŠ¿åˆ†æ
- **ç”¨æˆ·ä½“éªŒç›‘æ§**ï¼šå…³æ³¨çœŸå®ç”¨æˆ·ä½“éªŒ

### 3. å®‰å…¨ç­–ç•¥
- **çºµæ·±é˜²å¾¡**ï¼šå¤šå±‚å®‰å…¨é˜²æŠ¤
- **æœ€å°æƒé™**ï¼šæœ€å°åŒ–è®¿é—®æƒé™
- **æŒç»­ç›‘æ§**ï¼šå®æ—¶å®‰å…¨ç›‘æ§å’Œå“åº”
- **åˆè§„ç®¡ç†**ï¼šæ»¡è¶³è¡Œä¸šåˆè§„è¦æ±‚

### 4. è¿ç»´ç­–ç•¥
- **è‡ªåŠ¨åŒ–ä¼˜å…ˆ**ï¼šå‡å°‘äººå·¥æ“ä½œé”™è¯¯
- **æ–‡æ¡£é©±åŠ¨**ï¼šå®Œå–„çš„è¿ç»´æ–‡æ¡£
- **æ•…éšœæ¼”ç»ƒ**ï¼šå®šæœŸè¿›è¡Œæ•…éšœæ¼”ç»ƒ
- **æŒç»­æ”¹è¿›**ï¼šåŸºäºç›‘æ§æ•°æ®æŒç»­ä¼˜åŒ–

## ğŸ”— ç”Ÿäº§ç¯å¢ƒå·¥å…·æ¨è

### ç›‘æ§å·¥å…·
- **Prometheus + Grafana**ï¼šæŒ‡æ ‡ç›‘æ§å’Œå¯è§†åŒ–
- **ELK Stack**ï¼šæ—¥å¿—æ”¶é›†å’Œåˆ†æ
- **Jaeger**ï¼šåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª
- **New Relic / DataDog**ï¼šAPMç›‘æ§

### éƒ¨ç½²å·¥å…·
- **Kubernetes**ï¼šå®¹å™¨ç¼–æ’å¹³å°
- **Helm**ï¼šKubernetesåŒ…ç®¡ç†
- **ArgoCD**ï¼šGitOpsæŒç»­éƒ¨ç½²
- **Terraform**ï¼šåŸºç¡€è®¾æ–½å³ä»£ç 

### å®‰å…¨å·¥å…·
- **Vault**ï¼šå¯†é’¥ç®¡ç†
- **Falco**ï¼šè¿è¡Œæ—¶å®‰å…¨ç›‘æ§
- **Trivy**ï¼šå®¹å™¨é•œåƒå®‰å…¨æ‰«æ
- **OPA**ï¼šç­–ç•¥å¼•æ“

### è¿ç»´å·¥å…·
- **Ansible**ï¼šé…ç½®ç®¡ç†
- **Jenkins**ï¼šCI/CDæµæ°´çº¿
- **PagerDuty**ï¼šäº‹ä»¶ç®¡ç†
- **Slack**ï¼šå›¢é˜Ÿåä½œ

## ğŸ¯ ç”Ÿäº§éƒ¨ç½²æˆåŠŸæ ‡å‡†

### æŠ€æœ¯æŒ‡æ ‡
- **å¯ç”¨æ€§**ï¼š99.9%ä»¥ä¸Šçš„æœåŠ¡å¯ç”¨æ€§
- **æ€§èƒ½**ï¼šå“åº”æ—¶é—´P95 < 500ms
- **å®¹é‡**ï¼šæ”¯æŒé¢„æœŸç”¨æˆ·è´Ÿè½½
- **å®‰å…¨**ï¼šé€šè¿‡å®‰å…¨å®¡è®¡å’Œåˆè§„æ£€æŸ¥

### è¿ç»´æŒ‡æ ‡
- **éƒ¨ç½²é¢‘ç‡**ï¼šæ”¯æŒé¢‘ç¹å®‰å…¨éƒ¨ç½²
- **æ•…éšœæ¢å¤æ—¶é—´**ï¼šMTTR < 30åˆ†é’Ÿ
- **å˜æ›´æˆåŠŸç‡**ï¼š>95%çš„å˜æ›´æˆåŠŸç‡
- **ç›‘æ§è¦†ç›–ç‡**ï¼š>90%çš„ç³»ç»Ÿç›‘æ§è¦†ç›–

### ä¸šåŠ¡æŒ‡æ ‡
- **ç”¨æˆ·æ»¡æ„åº¦**ï¼šç”¨æˆ·ä½“éªŒæŒ‡æ ‡è‰¯å¥½
- **æˆæœ¬æ•ˆç›Š**ï¼šåˆç†çš„è¿è¥æˆæœ¬
- **æ‰©å±•èƒ½åŠ›**ï¼šæ”¯æŒä¸šåŠ¡å¢é•¿éœ€æ±‚
- **åˆè§„æ€§**ï¼šæ»¡è¶³ç›¸å…³æ³•è§„è¦æ±‚

æ­å–œä½ å®Œæˆäº†OpenHandsé¡¹ç›®çš„å®Œæ•´å­¦ä¹ ä¹‹æ—…ï¼ä»åŸºç¡€ç†è§£åˆ°ç”Ÿäº§éƒ¨ç½²ï¼Œä½ å·²ç»æŒæ¡äº†å…¨æ ˆå¼€å‘å’Œè¿ç»´çš„æ ¸å¿ƒæŠ€èƒ½ã€‚ç°åœ¨ä½ å¯ä»¥ï¼š

1. **ç‹¬ç«‹å¼€å‘**ï¼šå…·å¤‡å®Œæ•´çš„OpenHandså¼€å‘èƒ½åŠ›
2. **ç³»ç»Ÿæ‰©å±•**ï¼šèƒ½å¤Ÿæ‰©å±•å’Œå®šåˆ¶OpenHandsåŠŸèƒ½
3. **ç”Ÿäº§éƒ¨ç½²**ï¼šå…·å¤‡ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å’Œè¿ç»´èƒ½åŠ›
4. **æŒç»­æ”¹è¿›**ï¼šå»ºç«‹æŒç»­å­¦ä¹ å’Œæ”¹è¿›çš„èƒ½åŠ›

ç»§ç»­å®è·µå’Œæ¢ç´¢ï¼Œæˆä¸ºOpenHandsç”Ÿæ€çš„é‡è¦è´¡çŒ®è€…ï¼ğŸš€
